<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EngageSense: Real-Time Analysis</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f4f4f9;
      text-align: center;
    }
    .container {
      padding: 20px;
      max-width: 1200px;
      margin: auto;
    }
    canvas {
      margin: 20px auto;
      max-width: 800px;
      height: 400px;
    }
    .scorecard {
      margin: 20px auto;
      padding: 20px;
      width: 300px;
      background-color: #fff;
      border: 1px solid #ddd;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }
    .scorecard h2 {
      font-size: 2rem;
      margin: 10px 0;
    }
    button {
      margin: 10px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
    }
    .button-row {
      display: flex;
      justify-content: center;
      gap: 20px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>EngageSense: Real-Time Analysis</h1>
    <p>Real-time emotion detection, engagement scoring, and dynamic visualizations.</p>

    <!-- Scorecard -->
    <div class="scorecard">
      <h3>Engagement Score</h3>
      <h2 id="engagement-score">0</h2>
      <p id="engagement-class">Class: N/A</p>
    </div>

    <!-- Emotion Chart -->
    <canvas id="emotionChart"></canvas>

    <!-- Engagement Chart -->
    <canvas id="engagementChart"></canvas>

    <!-- Buttons -->
    <div class="button-row">
      <button onclick="startRealTimeProcessing()">Start Real-Time Analysis</button>
      <button onclick="stopRealTimeProcessing()">Stop Analysis</button>
      <button onclick="exportToPDF()">Export to PDF</button>
      <button onclick="exportToCSV()">Export to CSV</button>
    </div>
  </div>

  <script>
    let emotionInterval, engagementInterval;
    let emotionChart, engagementChart;
    let emotionData = [];
    let engagementData = [];
    let time = 0;

    // Initialize Emotion Chart
    function initEmotionChart() {
      const ctx = document.getElementById('emotionChart').getContext('2d');
      emotionChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: ['Happy', 'Sad', 'Angry', 'Surprised', 'Fearful', 'Disgusted', 'Neutral'],
          datasets: [{
            label: 'Emotion Intensity',
            data: [0, 0, 0, 0, 0, 0, 0],
            backgroundColor: [
              'rgba(75, 192, 192, 0.6)',
              'rgba(54, 162, 235, 0.6)',
              'rgba(255, 99, 132, 0.6)',
              'rgba(255, 206, 86, 0.6)',
              'rgba(153, 102, 255, 0.6)',
              'rgba(201, 203, 207, 0.6)',
              'rgba(255, 159, 64, 0.6)'
            ]
          }]
        },
        options: {
          responsive: true,
          plugins: {
            title: {
              display: true,
              text: 'Emotion Intensity in Real-Time'
            }
          },
          scales: {
            y: {
              title: {
                display: true,
                text: 'Intensity'
              },
              beginAtZero: true
            }
          }
        }
      });
    }

    // Initialize Engagement Chart
    function initEngagementChart() {
      const ctx = document.getElementById('engagementChart').getContext('2d');
      engagementChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: [],
          datasets: [{
            label: 'Engagement Score',
            data: [],
            borderColor: 'rgba(75, 192, 192, 1)',
            fill: false
          }]
        },
        options: {
          responsive: true,
          plugins: {
            title: {
              display: true,
              text: 'Engagement Score Over Time'
            }
          },
          scales: {
            y: {
              title: {
                display: true,
                text: 'Engagement Score'
              },
              beginAtZero: true
            },
            x: {
              title: {
                display: true,
                text: 'Time'
              }
            }
          }
        }
      });
    }

    // Start Real-Time Processing
    function startRealTimeProcessing() {
      // Simulate Emotion Detection
      emotionInterval = setInterval(() => {
        const emotions = {
          Happy: Math.random() * 100,
          Sad: Math.random() * 50,
          Angry: Math.random() * 30,
          Surprised: Math.random() * 80,
          Fearful: Math.random() * 20,
          Disgusted: Math.random() * 10,
          Neutral: Math.random() * 100
        };

        emotionData.push(emotions);
        emotionChart.data.datasets[0].data = [
          emotions.Happy,
          emotions.Sad,
          emotions.Angry,
          emotions.Surprised,
          emotions.Fearful,
          emotions.Disgusted,
          emotions.Neutral
        ];
        emotionChart.update();
      }, 2000);

      // Simulate Engagement Scoring
      engagementInterval = setInterval(() => {
        const engagementScore = Math.random() * 100;
        const engagementClass = engagementScore > 75 ? 'High' : engagementScore > 50 ? 'Moderate' : 'Low';

        engagementData.push({ time, engagementScore });
        document.getElementById('engagement-score').textContent = engagementScore.toFixed(2);
        document.getElementById('engagement-class').textContent = `Class: ${engagementClass}`;

        engagementChart.data.labels.push(time++);
        engagementChart.data.datasets[0].data.push(engagementScore);

        if (engagementChart.data.labels.length > 20) {
          engagementChart.data.labels.shift();
          engagementChart.data.datasets[0].data.shift();
        }
        engagementChart.update();
      }, 2000);
    }

    // Stop Real-Time Processing
    function stopRealTimeProcessing() {
      clearInterval(emotionInterval);
      clearInterval(engagementInterval);
      alert("Real-Time Processing Stopped.");
    }

    // Export to PDF
    function exportToPDF() {
      const pdf = new jsPDF();
      pdf.text('EngageSense Report', 10, 10);
      pdf.save('EngageSense_Report.pdf');
    }

    // Export to CSV
    function exportToCSV() {
      const csvContent = "data:text/csv;charset=utf-8," + 
        engagementData.map(e => `${e.time},${e.engagementScore}`).join("\n");
      const encodedUri = encodeURI(csvContent);
      const link = document.createElement("a");
      link.setAttribute("href", encodedUri);
      link.setAttribute("download", "EngageSense_Data.csv");
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    // Initialize Charts on Load
    window.onload = () => {
      initEmotionChart();
      initEngagementChart();
    };
  </script>
</body>
</html>
